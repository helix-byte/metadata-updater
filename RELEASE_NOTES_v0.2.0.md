# Metadata Updater v0.2.0 发布说明

## v0.2.0 新功能：智能文件重命名 (2026-02-02)

### 🎉 核心功能

**自动文件重命名**
- 使用 LLM 生成高度概括的文件名
- 格式：`[7-13个汉字]-[YYYYMMDD]`
- 第一部分：LLM 生成的对话内容概括（7-13个汉字）
- 第二部分：日期时间戳（YYYYMMDD 格式），确保唯一性
- 自动检测文件名冲突，如有冲突则添加序号（如 `-1`, `-2`）
- 支持单个文件和批量重命名

### 📝 文件名格式示例

```
异或逻辑探讨-20260202
编程技巧交流-20260202
哲学思考记录-20260202
# 如果同一天有多个相同概括的文件
异或逻辑探讨-20260202-1
异或逻辑探讨-20260202-2
```

### ✨ 功能特性

1. **LLM 智能概括**
   - 自动分析对话内容
   - 生成 7-13 个汉字的简洁概括
   - 准确反映对话主题

2. **千字文随机标识**
   - 使用《千字文》中的汉字
   - 确保文件名唯一性
   - 总长度固定为 21 个字符（20个汉字 + 1个"-"）

3. **冲突检测**
   - 自动检查仓库内文件名冲突
   - 最多尝试 100 次生成唯一文件名
   - 如果仍有冲突，添加时间戳作为后备方案

4. **批量处理支持**
   - 单个文件更新：自动重命名当前文件
   - 批量更新：重命名所有 Markdown 文件
   - 智能跳过已符合格式的文件

### ⚙️ 设置选项

在插件设置中新增：

**基本设置**
- **Auto rename**: 启用/禁用自动文件重命名
  - 默认：禁用
  - 启用后，每次更新元数据时自动重命名文件
  - 文件名格式：`[7-13个汉字]-[YYYYMMDD]`

### 🔧 技术实现

**新增模块**
- `filenameGenerator.ts`: 文件名生成器
  - 日期时间戳生成（YYYYMMDD 格式）
  - 文件名冲突检测
  - 唯一文件名生成（支持序号后缀）

**修改模块**
- `llmExtractor.ts`:
  - 更新 LLM Prompt，要求生成 `filenameSummary`
  - `ExtractionResult` 接口新增 `filenameSummary` 字段

- `main.ts`:
  - 新增 `autoRenameEnabled` 设置选项
  - `updateNoteMetadata()` 函数集成重命名逻辑
  - 设置面板添加自动重命名开关

### 📋 使用方法

1. **启用自动重命名**
   - 打开 Obsidian 设置 → Metadata Updater
   - 在"基本设置"中启用"Auto rename"

2. **更新单个文件**
   - 打开要更新的笔记
   - 运行命令：`Update current note metadata`
   - 文件自动重命名为新格式

3. **批量更新**
   - 运行命令：`Update all notes metadata`
   - 所有 Markdown 文件自动重命名

### ⚠️ 注意事项

1. **默认禁用**
   - 自动重命名功能默认禁用
   - 需要手动启用后才会生效

2. **仅 LLM 模式**
   - 自动重命名仅在 LLM 提取模式下可用
   - 规则提取模式不会重命名文件

3. **文件名冲突**
   - 插件会自动检测和处理文件名冲突
   - 如果 100 次尝试后仍有冲突，会添加时间戳

4. **批量操作建议**
   - 建议先在测试 vault 中测试
   - 确认效果后再对正式 vault 进行批量操作

### 🔄 升级指南

从 v0.1.2 升级到 v0.2.0：

1. 替换 `main.js`、`manifest.json`、`styles.css`
2. 重启 Obsidian
3. 在设置中启用"Auto rename"（可选）
4. 测试单个文件更新
5. 如需批量重命名，运行"Update all notes metadata"

### 📊 性能影响

- **单文件更新**: 增加 1-2 秒（LLM 生成概括 + 重命名）
- **批量更新**: 根据文件数量线性增加
- **冲突检测**: 每次生成文件名时检查所有现有文件

### 🐛 已知问题

无

### 🚀 后续计划

- [ ] 支持自定义文件名格式
- [ ] 添加文件名预览功能
- [ ] 支持撤销重命名操作
- [ ] 添加重命名历史记录

---

## 功能特性

### 核心功能
- ✅ 智能关键词提取（LLM + 规则）
- ✅ 层级标签生成
- ✅ UTC 时间戳（created/updated）
- ✅ 自动摘要生成
- ✅ **智能文件重命名（新增）**
- ✅ 批量处理

### LLM 集成
- ✅ Ollama 本地模型支持
- ✅ 智能降级机制
- ✅ 连接测试功能
- ✅ **文件名概括生成（新增）**

### 配置管理
- ✅ 默认关键词分类配置
- ✅ 自定义配置文件
- ✅ 配置验证
- ✅ 多配置合并

---

## 安装方法

### 手动安装
1. 下载最新版本的插件文件
2. 将 `main.js`、`manifest.json` 和 `styles.css` 复制到你的 Obsidian vault 的 `.obsidian/plugins/metadata-updater/` 目录
3. 在 Obsidian 设置中启用插件

### 开发模式
```bash
# 克隆仓库
git clone https://github.com/yourusername/metadata-updater.git

# 进入目录
cd metadata-updater

# 安装依赖
npm install

# 开发模式编译（监听文件变化）
npm run dev

# 生产环境构建
npm run build
```

---

## 许可证

MIT License

---

**发布日期**: 2026-02-02
**版本**: 0.2.0
**作者**: Yichun Wang
